var _=Object.defineProperty;var J=(l,r,m)=>r in l?_(l,r,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[r]=m;var k=(l,r,m)=>(J(l,typeof r!="symbol"?r+"":r,m),m);import{j as s}from"./FileViewer-DkaHswXt.js";import{r as n,R as g}from"./TrackingPixels-B80Lgev0.js";import{B as H}from"./Base-4BtwEV-E.js";import{c as V}from"./ReactAppend-CY8yKZvG.js";import{r as E}from"./DxBox-C52wWe69.js";import{S as X}from"./sweetalert2.all-C96erxsa.js";import{M as K}from"./Modal-CJBbhQ-7.js";import{T as Q}from"./Table-ux6p-2ih.js";import{I as Z}from"./ImageFormGroup-yZTAH_8o.js";import{I as D}from"./InputFormGroup-DDhzlCe_.js";import{S as ee}from"./SelectFormGroup-DYWvpzd2.js";import{D as B}from"./DxButton-CsjWvhyj.js";import{C as se}from"./CreateReactScript-BEktg6JA.js";import{R as I}from"./ReactAppend-Yu2UtNlL.js";import{B as te}from"./BenefitsSection-D258VEiO.js";import{F as ie,a as ae,b as re,c as le,d as ne,e as ce,f as oe,g as me,h as de,i as fe,j as pe,k as ue,l as he}from"./index-CMwZT9j_.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";import"./Filter-BZ5YA63n.js";/* empty css               */class xe extends te{constructor(){super(...arguments);k(this,"path","admin/staff");k(this,"hasFiles",!0)}}const w=new xe,y=[{id:"facebook",name:"Facebook",icon:ie},{id:"instagram",name:"Instagram",icon:ae},{id:"twitter",name:"Twitter/X",icon:re},{id:"linkedin",name:"LinkedIn",icon:le},{id:"youtube",name:"YouTube",icon:ne},{id:"tiktok",name:"TikTok",icon:ce},{id:"whatsapp",name:"WhatsApp",icon:oe},{id:"telegram",name:"Telegram",icon:me},{id:"discord",name:"Discord",icon:de},{id:"snapchat",name:"Snapchat",icon:fe},{id:"pinterest",name:"Pinterest",icon:pe},{id:"reddit",name:"Reddit",icon:ue},{id:"email",name:"Email",icon:he}],be=()=>{const l=n.useRef(),r=n.useRef(),m=n.useRef(),j=n.useRef(),v=n.useRef(),N=n.useRef(),x=n.useRef(),[f,p]=n.useState([{value:""}]),[c,u]=n.useState([{social:"",link:""}]),[d,b]=n.useState([]),[F,A]=n.useState(!1),[C,R]=n.useState(!1);n.useEffect(()=>{C&&c.length>0&&setTimeout(()=>{c.forEach((e,t)=>{var i;(i=d[t])!=null&&i.current&&e.social&&$(d[t].current).val(e.social).trigger("change")}),R(!1)},300)},[C,c,d]);const G=()=>{p([...f,{value:""}])},z=(e,t)=>{const i=[...f];i[e].value=t,p(i)},L=e=>{if(f.length<=1)return;const t=f.filter((i,a)=>a!==e);p(t)},P=()=>{u([...c,{social:"",link:""}]),b([...d,g.createRef()])},M=(e,t)=>{const i=[...c];i[e].link=t,u(i)},U=e=>{if(c.length<=1)return;const t=c.filter((a,h)=>h!==e),i=d.filter((a,h)=>h!==e);u(t),b(i)},T=e=>{if(A(!!(e!=null&&e.id)),m.current.value=(e==null?void 0:e.id)||"",j.current.value=(e==null?void 0:e.name)||"",v.current.value=(e==null?void 0:e.job)||"",N.current.value=(e==null?void 0:e.description)||"",x.current.value=null,e!=null&&e.image&&(x.image.src=`/api/staff/media/${e.image}`),e!=null&&e.characteristics&&e.characteristics.length>0?p(e.characteristics.map(t=>({value:t}))):p([{value:""}]),e!=null&&e.socials&&e.socials.length>0){console.log("Datos de socials desde DB:",e.socials);const t=e.socials.map(a=>({social:a.social||"",link:a.link||""}));console.log("Socials procesados:",t);const i=t.map(()=>g.createRef());u(t),b(i),R(!0)}else u([{social:"",link:""}]),b([g.createRef()]),R(!1);$(r.current).modal("show")},W=async e=>{e.preventDefault();const t=new FormData;t.append("name",j.current.value),t.append("job",v.current.value),t.append("description",N.current.value),F&&t.append("id",m.current.value),x.current.files[0]&&t.append("image",x.current.files[0]);const i=f.map(o=>o.value.trim()).filter(o=>o.length>0);t.append("characteristics",JSON.stringify(i));const a=c.filter(o=>o.social&&o.link.trim()).map(o=>({social:o.social,link:o.link.trim()}));t.append("socials",JSON.stringify(a)),await w.save(t)&&($(l.current).dxDataGrid("instance").refresh(),$(r.current).modal("hide"),p([{value:""}]),u([{social:"",link:""}]),b([g.createRef()]))},q=async e=>{const{isConfirmed:t}=await X.fire({title:"Eliminar Staff",text:"¿Estás seguro de eliminar este staff?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!t||!await w.delete(e)||$(l.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(Q,{gridRef:l,title:"Staff",rest:w,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(l.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo staff",onClick:()=>T()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"job",caption:"Puesto",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:t})=>{e.html(E(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:t.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:t})=>{t.characteristics&&e.html(E(s.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[t.characteristics.slice(0,2).map((i,a)=>s.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:s.jsxs("small",{children:["• ",i]})},a)),t.characteristics.length>2&&s.jsx("li",{children:s.jsxs("small",{className:"text-muted",children:["+",t.characteristics.length-2," ","más..."]})})]})))}},{dataField:"socials",caption:"Redes sociales",cellTemplate:(e,{data:t})=>{if(!t.socials||t.socials.length===0){e.html('<small class="text-muted">Sin redes</small>');return}const i=Array.isArray(t.socials)?t.socials:[],a=i.slice(0,3);I(e,s.jsxs("div",{className:"d-flex align-items-center",children:[a.map((h,o)=>{const S=y.find(Y=>Y.id===h.social);if(!S)return null;const O=S.icon;return s.jsx("span",{className:"me-2",title:S.name,children:s.jsx(O,{size:16})},o)}),i.length>3&&s.jsxs("small",{className:"text-muted",children:["+",i.length-3]})]}))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:t})=>{I(e,s.jsx("img",{src:`/api/staff/media/${t.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:i=>i.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:t})=>{e.append(B({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>T(t)})),e.append(B({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>q(t.id)}))}}]}),s.jsxs(K,{modalRef:r,title:F?"Editar Staff":"Nuevo Staff",onSubmit:W,size:"lg",children:[s.jsx("input",{ref:m,type:"hidden"}),s.jsxs("div",{className:"row",id:"staff-modal-container",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx(D,{eRef:j,label:"Nombres del staff",required:!0}),s.jsx(D,{eRef:v,label:"Puesto laboral",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:N,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),f.map((e,t)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:i=>z(t,i.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>L(t),disabled:f.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},t)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:G,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(Z,{eRef:x,label:"Imagen principal",aspect:1}),s.jsxs("div",{className:"mb-3",children:[s.jsxs("label",{className:"form-label d-flex justify-content-between align-items-center",children:[s.jsx("span",{children:"Redes sociales"}),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:P,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar"]})]}),s.jsxs("div",{className:"border rounded p-3",style:{maxHeight:"400px",overflowY:"auto"},children:[c.map((e,t)=>{d[t]||(d[t]=g.createRef());const i=y.find(a=>a.id===e.social);return console.log(`Renderizando social ${t}:`,e,"Link value:",e.link),s.jsxs("div",{className:"mb-3 pb-3 border-bottom",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsxs("small",{className:"text-muted fw-bold",children:["Red Social #",t+1]}),s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>U(t),disabled:c.length<=1,title:"Eliminar red social",children:s.jsx("i",{className:"fas fa-trash-alt"})})]}),s.jsxs(ee,{eRef:d[t],label:"Tipo de red social",dropdownParent:"#staff-modal-container",children:[s.jsx("option",{value:"",children:"Seleccionar red social..."}),y.map(a=>(a.icon,s.jsx("option",{value:a.id,children:a.name},a.id)))]}),i&&s.jsx("div",{className:"mb-2",children:s.jsxs("div",{className:"alert alert-info py-2 px-3 mb-0 d-flex align-items-center",children:[s.jsx(i.icon,{className:"me-2",size:20}),s.jsxs("small",{className:"mb-0",children:[s.jsx("strong",{children:i.name})," seleccionado"]})]})}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"form-label mb-1",children:s.jsx("small",{children:(i==null?void 0:i.id)==="email"?"Correo electrónico":"Enlace / URL"})}),s.jsx("input",{type:(i==null?void 0:i.id)==="email"?"email":"text",className:"form-control",placeholder:(i==null?void 0:i.id)==="email"?"ejemplo@correo.com":`https://${e.social||"ejemplo"}.com/tu-usuario`,value:e.link||"",onChange:a=>M(t,a.target.value)})]})]},t)}),c.length===0&&s.jsxs("div",{className:"text-center text-muted py-4",children:[s.jsx("i",{className:"fas fa-share-alt mb-2",style:{fontSize:"2rem"}}),s.jsx("p",{className:"mb-0",children:"No hay redes sociales agregadas"})]})]})]})]})]})]})]})};se((l,r)=>{V(l).render(s.jsx(H,{...r,title:"Staffs",children:s.jsx(be,{...r})}))});
