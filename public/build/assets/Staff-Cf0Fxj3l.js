var J=Object.defineProperty;var V=(n,l,m)=>l in n?J(n,l,{enumerable:!0,configurable:!0,writable:!0,value:m}):n[l]=m;var y=(n,l,m)=>(V(n,typeof l!="symbol"?l+"":l,m),m);import{j as s}from"./FileViewer-DkaHswXt.js";import{r,R as w}from"./TrackingPixels-B80Lgev0.js";import{B as X}from"./Base-4BtwEV-E.js";import{c as K}from"./ReactAppend-CY8yKZvG.js";import{r as D}from"./DxBox-C52wWe69.js";import{S as Q}from"./sweetalert2.all-C96erxsa.js";import{M as Z}from"./Modal-CJBbhQ-7.js";import{T as ee}from"./Table-ux6p-2ih.js";import{I as se}from"./ImageFormGroup-yZTAH_8o.js";import{I}from"./InputFormGroup-DDhzlCe_.js";import{S as ae}from"./SelectFormGroup-DYWvpzd2.js";import{D as B}from"./DxButton-CsjWvhyj.js";import{C as te}from"./CreateReactScript-BEktg6JA.js";import{R as A}from"./ReactAppend-Yu2UtNlL.js";import{B as ie}from"./BenefitsSection-D258VEiO.js";import{F as le,a as re,b as ne,c as ce,d as oe,e as me,f as de,g as ue,h as pe,i as fe,j as he,k as ge,l as xe}from"./index-CMwZT9j_.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";import"./Filter-BZ5YA63n.js";/* empty css               */class be extends ie{constructor(){super(...arguments);y(this,"path","admin/staff");y(this,"hasFiles",!0)}}const k=new be,F=[{id:"facebook",name:"Facebook",icon:le},{id:"instagram",name:"Instagram",icon:re},{id:"twitter",name:"Twitter/X",icon:ne},{id:"linkedin",name:"LinkedIn",icon:ce},{id:"youtube",name:"YouTube",icon:oe},{id:"tiktok",name:"TikTok",icon:me},{id:"whatsapp",name:"WhatsApp",icon:de},{id:"telegram",name:"Telegram",icon:ue},{id:"discord",name:"Discord",icon:pe},{id:"snapchat",name:"Snapchat",icon:fe},{id:"pinterest",name:"Pinterest",icon:he},{id:"reddit",name:"Reddit",icon:ge},{id:"email",name:"Email",icon:xe}],je=()=>{const n=r.useRef(),l=r.useRef(),m=r.useRef(),j=r.useRef(),v=r.useRef(),N=r.useRef(),g=r.useRef(),b=r.useRef(!1),[u,f]=r.useState([{value:""}]),[c,p]=r.useState([]),[d,x]=r.useState([]),[C,z]=r.useState(!1),[T,R]=r.useState(!1);r.useEffect(()=>{T&&c.length>0&&(b.current=!0,setTimeout(()=>{c.forEach((e,a)=>{var t;(t=d[a])!=null&&t.current&&e.social&&$(d[a].current).val(e.social).trigger("change")}),R(!1),setTimeout(()=>{b.current=!1},100)},300))},[T,c,d]);const L=()=>{f([...u,{value:""}])},G=(e,a)=>{const t=[...u];t[e].value=a,f(t)},M=e=>{if(u.length<=1)return;const a=u.filter((t,i)=>i!==e);f(a)},U=()=>{p([...c,{social:"",link:""}]),x([...d,w.createRef()])},P=(e,a)=>{if(console.log("updateSocialType llamado:",e,a,"isLoadingDataRef:",b.current),console.log("Estado actual de socials:",c),b.current){console.log("Ignorando onChange porque estamos cargando datos");return}const t=[...c];console.log("Antes de actualizar:",t[e]),t[e].social=a,console.log("Después de actualizar:",t[e]),p(t)},q=(e,a)=>{const t=[...c];t[e].link=a,p(t)},W=e=>{const a=c.filter((i,h)=>h!==e),t=d.filter((i,h)=>h!==e);p(a),x(t)},E=e=>{if(z(!!(e!=null&&e.id)),m.current.value=(e==null?void 0:e.id)||"",j.current.value=(e==null?void 0:e.name)||"",v.current.value=(e==null?void 0:e.job)||"",N.current.value=(e==null?void 0:e.description)||"",g.current.value=null,e!=null&&e.image&&(g.image.src=`/api/staff/media/${e.image}`),e!=null&&e.characteristics&&e.characteristics.length>0?f(e.characteristics.map(a=>({value:a}))):f([{value:""}]),e!=null&&e.socials&&e.socials.length>0){console.log("Datos de socials desde DB:",e.socials);const a=e.socials.map(i=>({social:i.social||"",link:i.link||""}));console.log("Socials procesados:",a);const t=a.map(()=>w.createRef());p(a),x(t),R(!0)}else p([]),x([]),R(!1);$(l.current).modal("show")},O=async e=>{e.preventDefault(),console.log("=== SUBMIT - Estado actual de socials:",c);const a=new FormData;a.append("name",j.current.value),a.append("job",v.current.value),a.append("description",N.current.value),C&&a.append("id",m.current.value),g.current.files[0]&&a.append("image",g.current.files[0]);const t=u.map(o=>o.value.trim()).filter(o=>o.length>0);a.append("characteristics",JSON.stringify(t));const i=c.filter(o=>o.social&&o.link.trim()).map(o=>({social:o.social,link:o.link.trim()}));console.log("=== SUBMIT - nonEmptySocials después del filtro:",i),a.append("socials",JSON.stringify(i)),await k.save(a)&&($(n.current).dxDataGrid("instance").refresh(),$(l.current).modal("hide"),f([{value:""}]),p([]),x([]))},Y=async e=>{const{isConfirmed:a}=await Q.fire({title:"Eliminar Staff",text:"¿Estás seguro de eliminar este staff?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!a||!await k.delete(e)||$(n.current).dxDataGrid("instance").refresh()};return s.jsxs(s.Fragment,{children:[s.jsx(ee,{gridRef:n,title:"Staff",rest:k,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(n.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo staff",onClick:()=>E()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"job",caption:"Puesto",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:a})=>{e.html(D(s.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:a.description})))}},{dataField:"characteristics",caption:"Características",cellTemplate:(e,{data:a})=>{a.characteristics&&e.html(D(s.jsxs("ul",{className:"m-0 ps-3",style:{listStyle:"none"},children:[a.characteristics.slice(0,2).map((t,i)=>s.jsx("li",{className:"text-truncate",style:{maxWidth:"250px"},children:s.jsxs("small",{children:["• ",t]})},i)),a.characteristics.length>2&&s.jsx("li",{children:s.jsxs("small",{className:"text-muted",children:["+",a.characteristics.length-2," ","más..."]})})]})))}},{dataField:"socials",caption:"Redes sociales",cellTemplate:(e,{data:a})=>{if(!a.socials||a.socials.length===0){e.html('<small class="text-muted">Sin redes</small>');return}const t=Array.isArray(a.socials)?a.socials:[],i=t.slice(0,3);A(e,s.jsxs("div",{className:"d-flex align-items-center",children:[i.map((h,o)=>{const S=F.find(H=>H.id===h.social);if(!S)return null;const _=S.icon;return s.jsx("span",{className:"me-2",title:S.name,children:s.jsx(_,{size:16})},o)}),t.length>3&&s.jsxs("small",{className:"text-muted",children:["+",t.length-3]})]}))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:a})=>{A(e,s.jsx("img",{src:`/api/staff/media/${a.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:t=>t.target.src="/images/default-thumbnail.jpg"}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:a})=>{e.append(B({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>E(a)})),e.append(B({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>Y(a.id)}))}}]}),s.jsxs(Z,{modalRef:l,title:C?"Editar Staff":"Nuevo Staff",onSubmit:O,size:"lg",children:[s.jsx("input",{ref:m,type:"hidden"}),s.jsxs("div",{className:"row",id:"staff-modal-container",children:[s.jsxs("div",{className:"col-md-6",children:[s.jsx(I,{eRef:j,label:"Nombres del staff",required:!0}),s.jsx(I,{eRef:v,label:"Puesto laboral",required:!0}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Descripción"}),s.jsx("textarea",{ref:N,className:"form-control",rows:4,required:!0})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{className:"form-label",children:"Características"}),u.map((e,a)=>s.jsxs("div",{className:"input-group mb-2",children:[s.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Egresada de la Universidad Nacional Federico Villarreal.",value:e.value,onChange:t=>G(a,t.target.value)}),s.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>M(a),disabled:u.length<=1,children:s.jsx("i",{className:"fas fa-times"})})]},a)),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:L,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),s.jsxs("div",{className:"col-md-6",children:[s.jsx(se,{eRef:g,label:"Imagen principal",aspect:1}),s.jsxs("div",{className:"mb-3",children:[s.jsxs("label",{className:"form-label d-flex justify-content-between align-items-center",children:[s.jsx("span",{children:"Redes sociales"}),s.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:U,children:[s.jsx("i",{className:"fas fa-plus me-1"})," Agregar"]})]}),s.jsx("div",{className:"border rounded p-3",style:{maxHeight:"400px",overflowY:"auto"},children:c.length===0?s.jsxs("div",{className:"text-center text-muted py-4",children:[s.jsx("i",{className:"fas fa-share-alt mb-2",style:{fontSize:"2rem"}}),s.jsx("p",{className:"mb-0",children:"No hay redes sociales agregadas"}),s.jsx("p",{className:"mb-0",children:s.jsx("small",{children:'Haz clic en "Agregar" para añadir una red social'})})]}):c.map((e,a)=>{d[a]||(d[a]=w.createRef());const t=F.find(i=>i.id===e.social);return console.log(`Renderizando social ${a}:`,e,"Link value:",e.link),s.jsxs("div",{className:"mb-3 pb-3 border-bottom",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[s.jsxs("small",{className:"text-muted fw-bold",children:["Red Social #",a+1]}),s.jsx("button",{type:"button",className:"btn btn-sm btn-outline-danger",onClick:()=>W(a),title:"Eliminar red social",children:s.jsx("i",{className:"fas fa-trash-alt"})})]}),s.jsxs(ae,{eRef:d[a],label:"Tipo de red social",dropdownParent:"#staff-modal-container",onChange:i=>P(a,i.target.value),children:[s.jsx("option",{value:"",children:"Seleccionar red social..."}),F.map(i=>(i.icon,s.jsx("option",{value:i.id,children:i.name},i.id)))]}),t&&s.jsx("div",{className:"mb-2",children:s.jsxs("div",{className:"alert alert-info py-2 px-3 mb-0 d-flex align-items-center",children:[s.jsx(t.icon,{className:"me-2",size:20}),s.jsxs("small",{className:"mb-0",children:[s.jsx("strong",{children:t.name})," seleccionado"]})]})}),s.jsxs("div",{className:"mt-2",children:[s.jsx("label",{className:"form-label mb-1",children:s.jsx("small",{children:(t==null?void 0:t.id)==="email"?"Correo electrónico":"Enlace / URL"})}),s.jsx("input",{type:(t==null?void 0:t.id)==="email"?"email":"text",className:"form-control",placeholder:(t==null?void 0:t.id)==="email"?"ejemplo@correo.com":`https://${e.social||"ejemplo"}.com/tu-usuario`,value:e.link||"",onChange:i=>q(a,i.target.value)})]})]},a)})})]})]})]})]})]})};te((n,l)=>{K(n).render(s.jsx(X,{...l,title:"Staffs",children:s.jsx(je,{...l})}))});
