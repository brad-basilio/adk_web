var q=Object.defineProperty;var O=(l,t,o)=>t in l?q(l,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[t]=o;var w=(l,t,o)=>(O(l,typeof t!="symbol"?t+"":t,o),o);import{j as r}from"./FileViewer-DkaHswXt.js";import{r as n}from"./TrackingPixels-B80Lgev0.js";import{B as _}from"./Base-4BtwEV-E.js";import{c as J}from"./ReactAppend-CY8yKZvG.js";import{r as L}from"./DxBox-C52wWe69.js";import{S as P}from"./sweetalert2.all-C96erxsa.js";import{B as V}from"./Results-D258VEiO.js";import{M as z}from"./Modal-CJBbhQ-7.js";import{T as W}from"./Table-ux6p-2ih.js";import{I as D}from"./ImageFormGroup-yZTAH_8o.js";import{I as H}from"./InputFormGroup-DDhzlCe_.js";import{D as F}from"./DxButton-CsjWvhyj.js";import{C as K}from"./CreateReactScript-BEktg6JA.js";import{R as y}from"./ReactAppend-Yu2UtNlL.js";import{S as Q}from"./SwitchFormGroup-COj39dTx.js";import{L as U}from"./Filter-BZ5YA63n.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";/* empty css               */class X extends V{constructor(){super(...arguments);w(this,"path","admin/services");w(this,"hasFiles",!0)}}const g=new X,Y=({brands:l})=>{const[t,o]=n.useState([]),u=n.useRef(),x=n.useRef(),v=n.useRef(),d=n.useRef(),b=n.useRef(),j=n.useRef(),f=n.useRef(),m=n.useRef(),[N,R]=n.useState([]),[a,p]=n.useState([{value:""}]),[C,T]=n.useState(!1),E=()=>{p([...a,{value:""}])},B=(e,i)=>{const s=[...a];s[e].value=i,p(s)},I=e=>{if(a.length<=1)return;const i=a.filter((s,h)=>h!==e);p(i)},S=e=>{o(e||null),T(!!(e!=null&&e.id)),v.current.value=(e==null?void 0:e.id)||"",d.current.value=(e==null?void 0:e.title)||"",b.current.value=(e==null?void 0:e.description)||"",j.current.value=(e==null?void 0:e.benefits)||"",f.current.value=null,m.current.value=null;const i=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(o({...e,transparent_color:!i,color:i?e==null?void 0:e.color:"transparent"}),e!=null&&e.image&&(f.image.src=`/api/service/media/${e.image}`),e!=null&&e.icon&&(m.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const s=e.gallery.map(h=>({url:`/api/service/media/${h}`,isNew:!1}));R(s)}else R([]);e!=null&&e.characteristics&&e.characteristics.length>0?p(e.characteristics.map(s=>({value:s}))):p([{value:""}]),$(x.current).modal("show")},G=async e=>{e.preventDefault();const i=new FormData;i.append("title",d.current.value),i.append("description",b.current.value),i.append("benefits",j.current.value),C&&i.append("id",v.current.value),f.current.files[0]&&i.append("image",f.current.files[0]),m.current.files[0]&&i.append("icon",m.current.files[0]),N.filter(c=>c.isNew).forEach((c,M)=>{i.append(`gallery[${M}]`,c.file)});const s=N.filter(c=>!c.isNew).map(c=>c.url.split("/").pop());i.append("existing_gallery",JSON.stringify(s));const h=a.map(c=>c.value.trim()).filter(c=>c.length>0);i.append("characteristics",JSON.stringify(h)),await g.save(i)&&($(u.current).dxDataGrid("instance").refresh(),$(x.current).modal("hide"),R([]),p([{value:""}]),m.current.value=null)},k=async e=>{const{isConfirmed:i}=await P.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!i||!await g.delete(e)||$(u.current).dxDataGrid("instance").refresh()},A=async({id:e,value:i})=>{await g.boolean({id:e,field:"visible",value:i})&&$(u.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(W,{gridRef:u,title:"Servicios",rest:g,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(u.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:i})=>{e.html(L(r.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:i.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:i})=>{i.image?y(e,r.jsx("img",{src:`/api/service/media/${i.image}`,style:{width:"80px",height:"45px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-thumbnail.jpg"})):e.html('<span class="text-muted">Sin imagen</span>')}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:i})=>{i.icon?y(e,r.jsx("img",{src:`/api/service/media/${i.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),y(e,r.jsx(Q,{checked:i.visible==1,onChange:()=>A({id:i.id,value:!i.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:i})=>{e.append(F({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>S(i)})),e.append(F({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>k(i.id)}))}}]}),r.jsxs(z,{modalRef:x,title:C?"Editar Servicio":"Nuevo Servicio",onSubmit:G,size:"lg",children:[r.jsx("input",{ref:v,type:"hidden"}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-6",children:[r.jsx(H,{eRef:d,label:"Título del servicio",required:!0}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Descripción"}),r.jsx("textarea",{ref:b,className:"form-control",rows:3,required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Beneficios / Por qué elegir este servicio"}),r.jsx("textarea",{ref:j,className:"form-control",rows:4,placeholder:"Describe los beneficios y ventajas de este servicio..."})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Características / Features"}),a.map((e,i)=>r.jsxs("div",{className:"input-group mb-2",children:[r.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Technical Troubleshooting",value:e.value,onChange:s=>B(i,s.target.value)}),r.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>I(i),disabled:a.length<=1,children:r.jsx("i",{className:"fas fa-times"})})]},i)),r.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:E,children:[r.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),r.jsxs("div",{className:"col-md-6",children:[r.jsx(D,{eRef:f,label:"Imagen principal",aspect:16/9}),r.jsx(D,{eRef:m,label:"Icono del servicio",aspect:1/1})]})]})]})]})};K((l,t)=>{J(l).render(r.jsx(U,{children:r.jsx(_,{...t,title:"Servicios",children:r.jsx(Y,{...t})})}))});
